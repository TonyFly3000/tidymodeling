---
title: "Data manipulation with tidyverse"

author: "Tony Duan"

execute:
  warning: false
  error: false
format:
  html:
    toc: true
    toc-location: right
    code-fold: show
    code-tools: true
    number-sections: true
    code-block-bg: true
    code-block-border-left: "#31BAE9"
---

dplyr is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges.


![](images/logo.png){width="231"}


## load package

```{r}
library(dplyr)
```


```{r}
packageVersion("dplyr")
```




```{r}
data(mtcars)
small_mtcars = mtcars %>% select(cyl, mpg,hp) %>% head()

```

## select column

### get column names

```{r}
names(small_mtcars)
```

### select by name


```{r}
mtcars %>% select(cyl, mpg,hp) 
```




### select columns by name match with 'p'



### select columns by index

#### select first and 3rd columns


#### select first to 3rd columns


## drop column

```{r}
small_mtcars %>% select(-cyl)
```

## Renaming column

```{r}
small_mtcars %>%rename(new_cyl=cyl)
```

## Create column

### Mutate

```{r}
small_mtcars %>%mutate(new_cyl=cyl+1)
```

### Transmute,create column and only keep this column

```{r}
small_mtcars %>%transmute(new_cyl=cyl+1)
```

## Filter rows

```{r}
small_mtcars %>%filter(cyl>5)
```

### Filters with AND conditions
```{r}
small_mtcars %>%filter(cyl>5,mpg>20)
```

### Filters with OR conditions

```{r}
small_mtcars %>%filter(cyl>5|mpg>20)
```



### filter row with index

#### 5th rows



#### 1 and 5tj rows


#### 1 to 5th rows


#### get ramdon 5 rows


## Append

### append by row


```{r}
small_mtcars %>% rbind(small_mtcars)
```



### append by column
```{r}
small_mtcars %>% cbind(small_mtcars)
```

### Dropping NA values

### keep NA values

## group by

### average,min,max,sum

```{r}
small_mtcars %>%group_by(cyl) %>% summarise(avg_mpg=mean(mpg)
                                            ,min_mpg=min(mpg)
                                            ,max_mpg=max(mpg)
                                            ,sum_mpg=sum(mpg))
```

### count record and count distinct record

```{r}
small_mtcars %>%group_by(cyl) %>% summarise(n_mpg=n()
                                            ,distinct_n_mpg=n_distinct(mpg)
                                            
                                            )
```
## order rows

```{r}
small_mtcars %>%arrange(cyl) 
```

### Sort in descending order

```{r}
small_mtcars %>%arrange(desc(cyl) )
```
### Arrange by multiple variables

```{r}
small_mtcars %>%arrange(cyl,mpg)
```


## join

### inner_join



### left join



### anti join

## Reshape tables


### Gather data long(wide to long)


### Spread data wide (long to wide)

## string


### upper case


### lower case



### match


### concatenation


### replace



### extract



## date

## dataframe to numpy array



# reference:

https://dplyr.tidyverse.org/
