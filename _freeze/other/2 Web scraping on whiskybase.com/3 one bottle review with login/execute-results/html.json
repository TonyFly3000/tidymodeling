{
  "hash": "e32ddafcc94a7c58be2b8beaa77ea00b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"on bottle review with log in\"\nsubtitle: \"with whiskybase.com data\"\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n  eval: false\n  \nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rvest)\nlibrary(stringr)\nlibrary(openxlsx)\nlibrary(readxl)\nlibrary(httr)\n```\n:::\n\n# check connection\n\n::: {.cell}\n\n```{.r .cell-code}\nurl='https://www.google.com.hk/'\n\nwb_url='https://www.whiskybase.com/'\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_session <- session(url)\n```\n:::\n\n200 is good\n::: {.cell}\n\n```{.r .cell-code}\nmy_session$response$status_code\n```\n:::\n\n# adding agent\n\nsome website need agent header\n\n::: {.cell}\n\n```{.r .cell-code}\nuser_a <- user_agent(\"Mozilla/5.0 (Macintosh; Intel Mac OS X 12_0_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36\")\n\nsession_with_ua <- session(wb_url, user_a)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua$response$status_code\n```\n:::\n\nshow agent header\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua$response$request$options$useragent\n```\n:::\n\n# go to page when log in\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua <- session_with_ua |> \n  session_jump_to(\"https://www.whiskybase.com/whiskies\")\nsession_with_ua\n```\n:::\n# check session visit history\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua %>% session_history()\n```\n:::\n\n\n\n# log in \n\n\n## find require info\n\nform 4 is login form\n\n::: {.cell}\n\n```{.r .cell-code}\nread_html('https://www.whiskybase.com/') %>%  html_form(\"form\")\n```\n:::\n\n# submit account and password\n\n::: {.cell}\n\n```{.r .cell-code}\npgform <- html_form(session_with_ua)[[4]]\npgform <- set_values(pgform,username = \"Jcwinningco@163.com\", password = \"qwe123WB\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nresult <- submit_form(session_with_ua, pgform)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua <- result |> \n  session_jump_to('https://www.whiskybase.com/whiskies/whisky/147142/macallan-12-year-old')\n\nsession_with_ua\n```\n:::\n# check login names\n\n::: {.cell}\n\n```{.r .cell-code}\nreview_people=page%>% html_nodes('.wb--username')%>% html_text()\nreview_people\n```\n:::\n\n# save html page\n::: {.cell}\n\n```{.r .cell-code}\npage=read_html(session_with_ua)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext=page%>% html_nodes(\"*\")%>% html_text2()\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_delim(tibble(text), \"./data/one bottle with log in.txt\")\n```\n:::\n\n\n# check score people\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua <- session_with_ua |> \n  session_jump_to('https://www.whiskybase.com/whiskies/whisky/147142/macallan-12-year-old#whisky-community')\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_with_ua %>% session_history()\n```\n:::\n::: {.cell}\n\n```{.r .cell-code}\npage=read_html(session_with_ua)\n```\n:::\n\n## in whisky list\n::: {.cell}\n\n```{.r .cell-code}\nreview_people=page%>% html_nodes('#whisky-community a')%>% html_text2()\nreview_people\n```\n:::\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}