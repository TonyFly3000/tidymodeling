{
  "hash": "69183e567f70da274a074a7eb93e34b9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"image processing\"\nsubtitle: \"with magick\"\n\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n\nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n    code-copy: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magick)\n```\n:::\n\n\n# input \n\n::: {.cell}\n\n```{.r .cell-code}\nraw_logo <- image_read('./images/comb.webp')\n```\n:::\n\n\n# output \n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_info(raw_logo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1   WEBP   450    303       sRGB  TRUE    49650   72x72\n```\n\n\n:::\n:::\n\n\n# change format\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_png <- image_convert(raw_logo, \"png\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_info(new_png)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG   450    303       sRGB  TRUE        0   72x72\n```\n\n\n:::\n:::\n\n\n# output\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_write(new_png, path = \"./images/new_png.png\", format = \"png\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_logo <- image_read('./images/logo1.png')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_logo %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE    53960   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n# fill corner white to greem\neach corner (top left, top right, bottom left, bottom right). For our real usage, we’re going to convert this “green” space to transparent instead.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_filled <- raw_logo %>% \n    image_fill(\"green\", \"+1+1\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"green\", \"+140+1\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"green\", \"+1+99\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"green\", \"+140+99\", fuzz = 50, refcolor = \"white\")\n\nimg_filled %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n# rotate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_filled %>% image_rotate(45) %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1632   1632       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-10-1.png){width=816}\n:::\n:::\n\n# make backgroup transparent (given 0-100 green color backgroup)\n\n::: {.cell}\n\n```{.r .cell-code}\nb=img_filled %>% image_transparent(color='green',10)\n\nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nimage_write(b, path = \"b.png\", format = \"png\")\n```\n:::\n\n\n# change opacity level\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb=img_filled %>% image_colorize(opacity =80, color = 'white')\nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n# change brightness level\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb=img_filled %>%image_modulate(brightness = 30)\n  \nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n# change blur level\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb=img_filled %>%  image_blur(10, 5)\n  \nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n# add text into picture\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb=img_filled %>% image_annotate( \"The quick brown fox\", font = 'Times', size = 80,gravity = \"southwest\", color = \"red\")\n  \nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n# resize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb= img_filled%>% image_resize(\"500\")\nb %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG   500    357       sRGB  TRUE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-16-1.png){width=250}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_info(img_filled)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       sRGB  TRUE        0   72x72\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_info(b)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG   500    357       sRGB  TRUE        0   72x72\n```\n\n\n:::\n:::\n\n# make logo black\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_filled2 <- raw_logo %>% \n    image_fill(\"transparent\", \"+1+1\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"transparent\", \"+140+1\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"transparent\", \"+1+99\", fuzz = 50, refcolor = \"white\") %>% \n    image_fill(\"transparent\", \"+140+99\", fuzz = 50, refcolor = \"white\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_filled2 %>% \n    image_channel(\"Opacity\") %>% \n    image_convert(matte=FALSE) %>% \n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  format width height colorspace matte filesize density\n1    PNG  1344    960       Gray FALSE        0   72x72\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```{.details summary=\"sessionInfo()\"}\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Sonoma 14.1.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Asia/Shanghai\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] magick_2.8.3\n\nloaded via a namespace (and not attached):\n [1] digest_0.6.35     fastmap_1.1.1     xfun_0.43         magrittr_2.0.3   \n [5] knitr_1.45        htmltools_0.5.8.1 png_0.1-8         rmarkdown_2.26   \n [9] cli_3.6.2         compiler_4.3.1    rstudioapi_0.16.0 tools_4.3.1      \n[13] evaluate_0.23     Rcpp_1.0.12       yaml_2.3.8        rlang_1.1.3      \n[17] jsonlite_1.8.8    htmlwidgets_1.6.4\n```\n\n\n:::\n:::\n\n\n\n\n# add backgroup image\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(png)\nlibrary(grid)\nlibrary(ggimage)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg <- readPNG(\"./images/new_png.png\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbees <- data.frame(distance = c(0.5, 1, 1.5, 2, 2.5, 3),\n                  number = c(40, 34, 32, 22,18, 10))\n\nggplot(data = bees, aes(x = distance, y = number)) +\n  annotation_custom(rasterGrob(img, \n                               width = unit(1,\"npc\"),\n                               height = unit(1,\"npc\")), \n                    -Inf, Inf, -Inf, Inf) +\n  geom_point() +\n  xlab(\"Distance (km)\") +\n  ylab(\"Number of Bees\") +\n  ylim(0, 45)\n```\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n# replace scatter with image\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbees$image <- \"./images/bee.png\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = bees, aes(x = distance, y = number)) +\n  annotation_custom(rasterGrob(img, \n                               width = unit(1,\"npc\"),\n                               height = unit(1,\"npc\")), \n                    -Inf, Inf, -Inf, Inf) +\n  geom_image(aes(image = image), size = 0.15) +\n  xlab(\"Distance (km)\") +\n  ylab(\"Number of Bees\") +\n  ylim(0, 45)\n```\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n# add logo \n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg2 =image_read(\"./images/logo1.png\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\np=ggplot(data = bees, aes(x = distance, y = number)) +\n  annotation_custom(rasterGrob(img, \n                               width = unit(1,\"npc\"),\n                               height = unit(1,\"npc\")), \n                    -Inf, Inf, -Inf, Inf) +\n  geom_image(aes(image = image), size = 0.15) +\n  xlab(\"Distance (km)\") +\n  ylab(\"Number of Bees\") +\n  ylim(0, 45)\n\n\n\nggdraw() +draw_plot(p,x = 0, y = 0.15, width = 1, height = 0.85) +draw_image(img2,x = 0.1, y = 0.1, width = 0.1, height = 0.1) \n```\n\n::: {.cell-output-display}\n![](3-image-processing_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n\n\n# resource:\n\n\nhttps://themockup.blog/posts/2021-01-28-removing-image-backgrounds-with-magick/\n\nhttps://cran.r-project.org/web/packages/magick/vignettes/intro.html\n\nhttps://buzzrbeeline.blog/2018/06/13/fun-and-easy-r-graphs-with-images/\n\n",
    "supporting": [
      "3-image-processing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}