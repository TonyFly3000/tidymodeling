{
  "hash": "d6973b82e7e29bd09b42a1a9dcd27873",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"All year all topic first time\"\nsubtitle: \"with whiskynote.be data\"\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n  eval: false\nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rvest)\n```\n:::\n\n\n# one page function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource('one_page.r')\n```\n:::\n\n\n\n\n\n# read in all link \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\ntopic_link=read_excel('./output/all year page2.xlsx',sheet='topic')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(topic_link)\n```\n:::\n\n\nexclude news\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnews=topic_link$topic_link_list %>% str_detect('/whisky-news/')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntopic_link002=topic_link$topic_link_list[!news]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(topic_link002)\n```\n:::\n\n\n\n#  start downlaod all page on first first try\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#test=one_page_function('https://www.whiskynotes.be/2020/irish-whiskey/teeling-1996-fill-your-own-teeling-chinkapin-oak-single-pot-still-distillery-exclusive/')%>% mutate(loop_num=3)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsink(\"log3.txt\", append=FALSE, split=TRUE)  # for screen and log\n\nlibrary(openxlsx)\n\npage=topic_link002\n\n\nall_page_review_list=data.frame()\n\nstart_time=Sys.time()\nprint(paste0(\"Start time: \", start_time))\n\nloop_num=0\n\nfor (i in page){\n   tryCatch({\n#############################     \n   loop_num=loop_num+1\n   print(paste0(\"################ Running loop No.\",which(page==i)))\n         \n   print(paste0(\"current time: \", Sys.time()))\n   \n   output=one_page_function(i) %>% mutate(loop_num=loop_num)\n\n   all_page_review_list=rbind(all_page_review_list,output)\n   \n   print(paste0(\"Used time: \", Sys.time()-start_time))\n   # ouput every 20 page\n   if (loop_num%%20==0){\n      print(paste0(\"############################## output to excel: \", loop_num))\n      write.xlsx(all_page_review_list,'./output/all_page_bottle_list3.xlsx')\n     }\n    \n   \n#############################        \n    }, error=function(e){cat(\"ERROR :\",conditionMessage(e), \"\\n\")})\n}\n\nend_time=Sys.time()\nprint(paste0(\"End time: \", end_time))\nprint(paste0(\"total used time: \", end_time-start_time))\n\nwrite.xlsx(all_page_review_list,'./output/all_page_bottle_list3.xlsx')\n\nsink()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}