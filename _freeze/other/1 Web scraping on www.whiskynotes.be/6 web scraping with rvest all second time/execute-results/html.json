{
  "hash": "fada1980ff0a15c86d820a8dfd087409",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"All year all topic second time\"\nsubtitle: \"with whiskynote.be data\"\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n  eval: false\nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rvest)\n```\n:::\n\n\n# one page function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource('one_page.r')\n```\n:::\n\n\n\n# read in all link \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\ntopic_link=read_excel('./output/all year page.xlsx',sheet='topic')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(topic_link)\n```\n:::\n\n\nexclude news\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnews=topic_link$topic_link_list %>% str_detect('whisky-news|whisky-bar')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntopic_link002=topic_link$topic_link_list[!news]\n```\n:::\n\n\nexclude no score page:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nno_score_page=c(\n\"https://www.whiskynotes.be/2011/blends/bloggers-blend-masterofmalt/\"         \n,\"https://www.whiskynotes.be/2012/glenfarclas/glenfarclas-1968-mytribute-5241/\"\n,\"https://www.whiskynotes.be/2012/ancnoc/ancnoc-distillery-visit/\"             \n,\"https://www.whiskynotes.be/2012/distillery-visits/old-pulteney/\"             \n,\"https://www.whiskynotes.be/2013/blends/cutty-sark-storm-appletiser/\"         \n,\"https://www.whiskynotes.be/2013/glenfarclas/glenfarclas-verticale/\"  \n)\n```\n:::\n\n\n\n# read in donload page:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinish_download=read_excel('./output/all_page_bottle_list_all.xlsx')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfinish_download_topic_link=unique(finish_download$review_url)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(finish_download_topic_link)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnon_finish_link=topic_link002 [! topic_link002 %in% c(finish_download_topic_link,no_score_page)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(non_finish_link)\n```\n:::\n\n\n\n# download non download page:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(openxlsx)\npage=non_finish_link\n\nall_page_review_list=data.frame()\n\nstart_time=Sys.time()\nprint(paste0(\"Start time: \", start_time))\n\nloop_num=0\n\nfor (i in page){\n   tryCatch({\n#############################     \n   loop_num=loop_num+1\n   print(paste0(\"Running loop No.\",which(page==i)))\n         \n   print(paste0(\"current time: \", Sys.time()))\n   \n   output=one_page_function(i)\n\n   all_page_review_list=rbind(all_page_review_list,output)\n   \n   \n   print(paste0(\"Used time: \", Sys.time()-start_time))\n   # ouput every 20 page\n   if (loop_num%%20==0){\n      print(paste0(\"#########################. output to excel: \", loop_num))\n      all_page_review_list_total=rbind(finish_download,all_page_review_list)\n      write.xlsx(all_page_review_list_total,'./output/all_page_bottle_list_all.xlsx')\n     }\n    \n   \n#############################        \n    }, error=function(e){cat(\"ERROR :\",conditionMessage(e), \"\\n\")})\n}\n\nend_time=Sys.time()\nprint(paste0(\"End time: \", end_time))\nprint(paste0(\"total used time: \", end_time-start_time))\n\n\noutput=one_page_function(i)\n\nall_page_review_list_total=rbind(finish_download,all_page_review_list)\n   \nwrite.xlsx(all_page_review_list_total,'./output/all_page_bottle_list_all.xlsx')\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}