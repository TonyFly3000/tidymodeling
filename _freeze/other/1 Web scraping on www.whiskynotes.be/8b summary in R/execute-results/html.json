{
  "hash": "81e95fdf29963633b226fce52d05d55b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Summary in R\"\nsubtitle: \"with whiskynote.be data\"\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n\nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#must install the package from github\n#install.packages('devtools')  \n#devtools::install_github(\"lchiffon/wordcloud2\")  \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(openxlsx)\nlibrary(readxl)\n```\n:::\n\n# read in data\n\n::: {.cell}\n\n```{.r .cell-code}\ndata001=read_excel('./output/all_page_bottle_list_all.xlsx')\nglimpse(data001)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,934\nColumns: 9\n$ bottle_name          <chr> \"Cognac Chollet Lot 1960 ‘Le Bon Vivant’ – Fins B…\n$ bottle_review_Nose   <chr> \"Nose: a rich, fragrant and fruity style. Honeyed…\n$ bottle_review_Mouth  <chr> \"Mouth: more spices now. Mint and pepper, leading…\n$ bottle_review_Finish <chr> \"Finish: medium to long, more on fruit tea now, a…\n$ all_page_score       <chr> \"0\", \"0\", \"0\", \"0\", \"0\", \"0\", \"0\", \"85\", \"82\", \"8…\n$ page_class           <chr> \"* Cognac\", \"* Cognac\", \"* Cognac\", \"Ledaig\", \"Le…\n$ page_published_date  <chr> \"30 November 2020\", \"30 November 2020\", \"30 Novem…\n$ page_title           <chr> \"Cognac Lot 1960 / XO / Lot 1906 (Malternative Be…\n$ review_url           <chr> \"https://www.whiskynotes.be/2020/cognac/cognac-lo…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata002=data001 %>% filter(as.numeric(all_page_score)>0,as.numeric(all_page_score)<100\n                       ,bottle_review_Nose !='no comment'\n                      ,bottle_review_Mouth !='no comment'\n                      ,bottle_review_Finish !='no comment'\n                           \n                           \n                           ) %>% \n  mutate(review=paste(bottle_review_Nose,bottle_review_Mouth,bottle_review_Finish) %>% \n                             str_to_lower() %>% str_replace_all(\"[[:punct:]]\", \"\") %>% \n                            str_replace_all('sweetness','sweet') %>% str_replace_all('apples','apple')%>% str_replace_all('oranges','orange') %>% str_replace_all('fruits','fruit')\n\n                           )\n\nreivew002=data002$review\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest='able stees a asdf df able' %>%str_split(\" \") %>% unlist %>% unique %>% paste(collapse = ' ')\ntest\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"able stees a asdf df\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nreivew003=c()\n\nfor (i in reivew002){\n a=i%>%str_split(\" \") %>% unlist %>% unique%>% paste(collapse = ' ')\n  reivew003=c(reivew003,a)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest001=reivew003 %>% tibble() %>% rename('review'='.')\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest002_without_sweet=test001[!grepl(\"sweet\",test001$review),]\ntest002_sweet=test001[grepl(\"sweet\",test001$review),]\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstring <- reivew003\n\ndata002=data.frame(string) %>%\n  separate_rows(string) %>%\n  count(string, sort = TRUE) %>%\n  filter(n >= 2)\n```\n:::\n\n# remove stop word\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytext)\n\ndata003 <- data002 %>%\n  anti_join(stop_words, by= c(\"string\" = \"word\"))\n```\n:::\n\n# remove non favour word\n\n::: {.cell}\n\n```{.r .cell-code}\ndata004 <- data003 %>% filter(!string %in% c('notes','hints'\n                                            ,'nose'\n                                           ,'finish'\n                                            ,'light', 'slightly', 'hint', 'nice'\n                                           ,'medium' , 'subtle', 'background','note' ,'plenty' ,'lots'\n                                           ,'mouth','bit','soft','dark')\n                                          )\n```\n:::\n\n# translate to chinese\n\n::: {.cell}\n\n```{.r .cell-code}\ndata005=head(data004,30)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gtranslate)\n#lang_codes\n\ndata005_cn=translate(data005$string, from = \"en\", to = \"zh-CN\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata005_cn=cbind(data005_cn,data005)\ndata005_cn=data005_cn %>% select(-string)\n```\n:::\n\n\n# word cloud  1 english\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(wordcloud2) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_graph_en=wordcloud2(data=data005, size=1)\n#my_graph_en\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(webshot2)\nlibrary(htmlwidgets)\n\nsaveWidget(my_graph_en,\"tmp_en.html\")#先保存为网页格式\n\nwebshot(\"tmp_en.html\", \"wordcloud_en.jpg\", delay = 2) ##IRIENI\n```\n\n::: {.cell-output-display}\n![](8b-summary-in-R_files/figure-html/unnamed-chunk-17-1.jpg){width=672}\n:::\n:::\n\n\n# word cloud  2 chinese\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nshowtext_auto()\npar(family=\"PingFangSC-Regular\")\nmy_graph=wordcloud2(data=data005_cn,size=1)\n#my_graph\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(webshot2)\nlibrary(htmlwidgets)\n\nsaveWidget(my_graph,\"tmp.html\")#先保存为网页格式\n\nwebshot(\"tmp.html\", \"wordcloud.jpg\", delay = 2) ##IRIENI\n```\n\n::: {.cell-output-display}\n![](8b-summary-in-R_files/figure-html/unnamed-chunk-19-1.jpg){width=672}\n:::\n:::\n\n# chart 1 with gglolt\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2) \nggplot(data005, aes(x=reorder(string,n), y=n)) +geom_text(aes(label = n), hjust = -0.1)+ ylim(min=0, 3200)+\n  geom_bar(stat=\"identity\")+coord_flip()\n```\n\n::: {.cell-output-display}\n![](8b-summary-in-R_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n# chart 2 add image gglolt\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2) \nlibrary(png)\nlibrary(grid)\nlibrary(patchwork) \n\n\nimg2 <- readPNG(\"en_glass.png\")\nimg3=rasterGrob(img2, width = unit(1,\"npc\"), height = unit(1,\"npc\"))\n\ngg=ggplot(data005, aes(x=reorder(string,n), y=n))+theme_classic()+geom_text(aes(label = n), hjust = -0.1)+xlab(\"Flavor\") + ylab(\"Frequency\")+scale_y_continuous(expand=c(0,0),limits=c(0,3200))+\n  geom_bar(stat=\"identity\",fill=\"#CD5C5C\")+coord_flip()+ggtitle(\"Whisky notes Top30 most used words\",subtitle = \"5K review\")+labs(caption = \"data source from www.whiskynote.be between 2010 to 2024\")+\n  inset_element(img3, 0.66, 0.15, 1, 0.75,align_to = 'full')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngg\n```\n\n::: {.cell-output-display}\n![](8b-summary-in-R_files/figure-html/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n# chart 2 add image gglolt in chinese\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add  logo to the graph you created\nlibrary(magick)\nlogo <- image_read(\"logo.png\")\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2) \nlibrary(png)\nlibrary(grid)\nlibrary(patchwork) \n\nlibrary(showtext)\nshowtext_auto()\n\n\nimg2 <- readPNG(\"cn_glass.png\")\nimg3=rasterGrob(img2, width = unit(1,\"npc\"), height = unit(1,\"npc\"))\n\ngg=ggplot(data005_cn, aes(x=reorder(data005_cn,n), y=n))+theme_classic()+geom_text(aes(label = n), hjust = -0.1)+xlab(\"风味\") + ylab(\"次数\")+scale_y_continuous(expand=c(0,0),limits=c(0,3200))+\n  geom_bar(stat=\"identity\",fill=\"#CD5C5C\")+coord_flip()+ggtitle(\"Whisky notes Top30 风味词\",subtitle = \"5K+ 酒评\")+labs(caption = \"数据源:www.whiskynote.be 从2010年到2024年\")+\n  inset_element(img3, 0.65, 0.15, 1, 0.75,align_to = 'full')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngg\ngrid::grid.raster(logo, x = 0.05, y = 0.01, just = c('left', 'bottom'), width = unit(2.5, 'inches'))\n```\n\n::: {.cell-output-display}\n![](8b-summary-in-R_files/figure-html/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"myplot.png\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{.details summary=\"sessionInfo()\"}\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS 15.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Asia/Shanghai\ntzcode source: internal\n\nattached base packages:\n[1] grid      stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] magick_2.8.5      patchwork_1.3.0   png_0.1-8         showtext_0.9-7   \n [5] showtextdb_3.0    sysfonts_0.8.9    htmlwidgets_1.6.4 webshot2_0.1.1   \n [9] wordcloud2_0.2.1  gtranslate_0.0.1  tidytext_0.4.2    readxl_1.4.3     \n[13] openxlsx_4.2.7.1  lubridate_1.9.4   forcats_1.0.0     stringr_1.5.1    \n[17] dplyr_1.1.4       purrr_1.0.2       readr_2.1.5       tidyr_1.3.1      \n[21] tibble_3.2.1      ggplot2_3.5.1     tidyverse_2.0.0  \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6      xfun_0.48         websocket_1.4.2   processx_3.8.4   \n [5] lattice_0.22-6    tzdb_0.4.0        vctrs_0.6.5       tools_4.4.1      \n [9] ps_1.8.1          generics_0.1.3    curl_6.2.0        janeaustenr_1.0.0\n[13] pkgconfig_2.0.3   tokenizers_0.3.0  Matrix_1.7-0      lifecycle_1.0.4  \n[17] farver_2.1.2      compiler_4.4.1    textshaping_0.4.0 munsell_0.5.1    \n[21] chromote_0.4.0    SnowballC_0.7.1   htmltools_0.5.8.1 yaml_2.3.10      \n[25] pillar_1.10.1     later_1.3.2       tidyselect_1.2.1  rvest_1.0.4      \n[29] zip_2.3.1         digest_0.6.37     stringi_1.8.4     labeling_0.4.3   \n[33] fastmap_1.2.0     colorspace_2.1-1  cli_3.6.4         magrittr_2.0.3   \n[37] withr_3.0.2       scales_1.3.0      promises_1.3.0    timechange_0.3.0 \n[41] rmarkdown_2.28    httr_1.4.7        cellranger_1.1.0  ragg_1.3.3       \n[45] hms_1.1.3         evaluate_1.0.1    knitr_1.48        rlang_1.1.5      \n[49] Rcpp_1.0.13-1     glue_1.8.0        xml2_1.3.6        rstudioapi_0.17.1\n[53] jsonlite_1.8.9    R6_2.6.1          systemfonts_1.1.0\n```\n\n\n:::\n:::\n\n\n\n# resource:\n\nhttps://github.com/Lchiffon/wordcloud2\n",
    "supporting": [
      "8b-summary-in-R_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}